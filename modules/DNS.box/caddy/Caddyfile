# The Caddyfile is an easy way to configure your Caddy web server.
#
# Unless the file starts with a global options block, the first
# uncommented line is always the address of your site.
#
# To use your own domain name (with automatic HTTPS), first make
# sure your domain's A/AAAA DNS records are properly pointed to
# this machine's public IP, then replace ":80" below with your
# domain name.

{
    admin off
}

# =====================================================
# Public services (*.mydomain.com via Cloudflare DNS)
# =====================================================
*.mydomain.com {

    tls {
        dns cloudflare {env.CLOUDFLARE_API_TOKEN}
    }

    @kanban host kanban.mydomain.com
    reverse_proxy @kanban service_VM_IP:port

    @n8n host n8n.mydomain.com
    reverse_proxy @n8n service_VM_IP:port

    @cook host cook.mydomain.com
    reverse_proxy @cook service_VM_IP:port

    @links host links.mydomain.com
    reverse_proxy @links service_VM_IP:port

    @keep host keep.mydomain.com
    reverse_proxy @keep service_VM_IP:port

    @drive host drive.mydomain.com
    reverse_proxy @drive service_VM_IP:port

    @llm host llm.mydomain.com
    reverse_proxy @llm service_VM_IP:port

    @ollama host ollama.mydomain.com
    reverse_proxy @ollama service_VM_IP:port
	
    @photos host photos.mydomain.com
    reverse_proxy @photos service_VM_IP:port

    handle {
        respond "Not found" 404
    }
}

# =====================================================
# Internal / private services (internal CA)
# =====================================================

mailarchive.mydomain.com {
    tls internal
    reverse_proxy service_VM_IP:port
}

obs.mydomain.com {
    tls internal
    reverse_proxy obs_VM_IP:port
}

metrics.obs.mydomain.com {
    tls internal
    reverse_proxy obs_VM_IP:port
}

logs.obs.mydomain.com {
    tls internal
    reverse_proxy obs_VM_IP:port
}

# Refer to the Caddy docs for more information:
# https://caddyserver.com/docs/caddyfile
