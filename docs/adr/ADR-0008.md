# ADR-0008: Grafana → n8n Automation Bridge

**Date:** 2025-11-10  
**Status:** Approved  
**Deciders:** Owner  
**Supersedes:** None  
**Relates to:** ADR-0006 (Observability Core), ADR-0007 (Observability Stack)

---

## Context
With Grafana serving as the central alerting and visualization layer for the observability stack, we need a standardized mechanism to route actionable alerts into the automation platform (**n8n**) for further orchestration and remediation.

The goal is to enable **alert-driven automation** while preserving auditability and separation of concerns:
- Grafana = detection and decision layer  
- n8n = execution layer  

---

## Decision
Adopt a **Grafana → n8n automation bridge** using **Grafana’s webhook alert channel** to trigger n8n workflows.

### Automation Flow
```
Loki → Grafana (alert rule triggers)
        ↓
Grafana Alert Webhook → n8n (HTTP Webhook node)
        ↓
n8n Workflow executes:
  - Generate reports or GitHub issues
  - Apply updates, restarts, or notifications
  - Log all results back into Loki
```

---

## Implementation Overview
1. **Webhook Channel:**  
   - Each alert rule in Grafana is linked to a dedicated n8n webhook URL.  
   - Payload includes alert metadata, rule name, and labels.

2. **n8n Workflow Handling:**  
   - Parse incoming payload.  
   - Determine workflow type (update, notification, diff report, etc.).  
   - Execute defined automation.  
   - Emit structured log entry back to Loki (via HTTP output or local logging).

3. **Security:**  
   - All webhooks are protected by Cloudflare Zero Trust Access.  
   - Optional API key validation in n8n.  
   - No direct unauthenticated access to n8n endpoints.

4. **Traceability:**  
   - Each automation action links back to the originating Grafana alert ID.  
   - Logs stored in Loki for full audit chain (alert → automation → result).

---

## Consequences
- Grafana remains the single point deciding *what triggers automation*.  
- n8n becomes the only executor for post-alert actions.  
- Alert misconfiguration or accidental triggering cannot directly impact runtime services without passing through observability rules.  
- All automation activity is automatically observable via the same stack.

---

## Notes
This pattern supports future extensions such as:
- Two-way feedback (n8n reporting resolution back to Grafana).  
- Alert classification and prioritization for selective automation.  
- Integration with GitHub Projects for workflow tracking.
