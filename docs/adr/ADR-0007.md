# ADR-0007: Observability Stack — Centralized Logging and Action Flow

**Date:** 2025-11-10  
**Status:** Approved  
**Deciders:** Owner  
**Supersedes:** None  
**Relates to:** ADR-0006 (Observability Core), ADR-0008 (Grafana → n8n Automations)

---

## Context
Multiple self-hosted services (n8n, Open WebUI, Ollama, Diun, etc.) generate logs and metrics.  
We need a unified observability pipeline that ensures all logs are ingested, visualized, and can later drive automated actions while maintaining traceability.

---

## Decision
Adopt a **centralized observability flow** with **Loki as the single source of truth** for logs, and **Grafana** as the visualization and alerting layer.

### Logging Data Flow
```
All sources (Diun, n8n, Docker, Ollama, Open WebUI, etc.)
        ↓
     Promtail (log collector)
        ↓
     Loki (log store & query layer)
        ↓
     Grafana (visualization & alert management)
```

### Actionable Flow
Actionable events must always originate from logs.

```
Grafana alert (based on Loki query pattern)
        ↓
     Webhook trigger → n8n
        ↓
     n8n performs actions (reporting, update workflows, notifications)
```

This ensures:
- **Traceability** — every automation stems from a logged event.  
- **Observability-first architecture** — logs precede actions.  
- **Auditability** — all system changes trace back to recorded log entries.

---

## Consequences
- All services must log to stdout/stderr in structured format (JSON or consistent text).  
- Promtail configurations must include relevant containers and projects.  
- Grafana becomes the single decision layer for what is “actionable.”  
- n8n acts only as an executor; it never triggers actions without log-based evidence.  

---

## Notes
Follow-up design for **Grafana → n8n** integration and workflow definitions will be covered in **ADR-0008**.
